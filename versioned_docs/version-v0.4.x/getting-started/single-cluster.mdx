---
title: Single Cluster
description: Deploy OpenChoreo on a single Kubernetes cluster for development and testing. Complete setup guide with k3d, Helm charts, and configuration steps.
---

import CodeBlock from '@theme/CodeBlock';
import Link from '@docusaurus/Link';
import {versions} from '../_constants.mdx';

# Single Cluster Setup

This guide describes how to set up a local OpenChoreo development environment using k3d (k3s in Docker) with pre-built images and Helm charts from the OpenChoreo registry.

<div className="step-card">
<div className="prereq-header-text">⚙️ Prerequisites</div>

Ensure the following tools are installed and meet the minimum supported versions:
- **Docker** (Engine [26.0+](https://docs.docker.com/engine/release-notes/26.0/) recommended)
  - Allocate at least **8 GB RAM** and **4 CPU** cores to Docker (or the VM running Docker).
- **[k3d](https://k3d.io/stable/#installation)** v5.8+ 
- **[kubectl](https://kubernetes.io/docs/tasks/tools/)** v1.32+
- **[Helm](https://helm.sh/docs/intro/install/)** v3.12+

<div className="content-section-highlight">
### Verify Prerequisites

Run the following commands to confirm that all prerequisites are available:

```bash
# Check Docker (should be v20.10+)
docker --version

# Check k3d (should be v5.8+)
k3d --version

# Check kubectl (should be v1.32+)
kubectl version --client

# Check Helm (should be v3.12+)
helm version --short

# Confirm Docker is running
docker info
```
</div> 

:::note
If you're using **Colima**, set the `K3D_FIX_DNS=0` environment variable when creating clusters to avoid DNS issues. See [k3d-io/k3d#1449](https://github.com/k3d-io/k3d/issues/1449) for details.
:::
</div>

<div className="step-card">
<div className="step-header">
<div className="step-header-icon">1</div>
<div className="step-header-text">Create the OpenChoreo k3d Cluster</div>
</div>

Create a new k3d cluster using the provided configuration:

<CodeBlock language="bash">
{`curl -s https://raw.githubusercontent.com/openchoreo/openchoreo/${versions.githubRef}/install/k3d/single-cluster/config.yaml | k3d cluster create --config=-`}
</CodeBlock>

This configuration:
- Creates a cluster named "openchoreo"
- Provisions 1 server and 2 agent nodes
- Configures port mappings for OpenChoreo services:
  - **Control Plane**: `localhost:8080` (HTTP), `localhost:8443` (HTTPS)
  - **Data Plane**: `localhost:9080` (HTTP), `localhost:9443` (HTTPS) - for deployed workloads
  - **Build Plane**: `localhost:10081` (Argo Workflows UI), `localhost:10082` (Container Registry)
  - **Observability Plane**: `localhost:11081` (OpenSearch Dashboard), `localhost:11082` (OpenSearch API)
- Sets the active `kubectl` context to **k3d-openchoreo**

:::tip
For faster setup or slow networks, preload images after creating the cluster. See the [Image Preloading](#image-preloading-optional) section.
:::

Verify the cluster is running:

```bash
kubectl get nodes
```
All nodes should report a `Ready` status.
</div>

<div className="step-card">
<div className="step-header">
<div className="step-header-icon">2</div>
<div className="step-header-text">Install the OpenChoreo Control Plane</div>
</div>

Install the control plane components. The `openchoreo-control-plane` namespace is created automatically:

<CodeBlock language="bash">
{`helm install openchoreo-control-plane oci://ghcr.io/openchoreo/helm-charts/openchoreo-control-plane \\
  --version ${versions.helmChart} \\
  --kube-context k3d-openchoreo \\
  --namespace openchoreo-control-plane \\
  --create-namespace \\
  --values https://raw.githubusercontent.com/openchoreo/openchoreo/${versions.githubRef}/install/k3d/single-cluster/values-cp.yaml`}
</CodeBlock>

Wait for the installation to complete, then verify that all pods are running:

```bash
kubectl get pods -n openchoreo-control-plane
```

You should see running pods for:
- `controller-manager` 
- `cert-manager-*` (3 pods)
</div>

<div className="step-card">
<div className="step-header">
<div className="step-header-icon">3</div>
<div className="step-header-text">Install the OpenChoreo Data Plane</div>
</div>

Install the data plane components. The `openchoreo-data-plane` namespace is created automatically:

<CodeBlock language="bash">
{`helm install openchoreo-data-plane oci://ghcr.io/openchoreo/helm-charts/openchoreo-data-plane \\
  --version ${versions.helmChart} \\
  --kube-context k3d-openchoreo \\
  --namespace openchoreo-data-plane \\
  --create-namespace \\
  --values https://raw.githubusercontent.com/openchoreo/openchoreo/${versions.githubRef}/install/k3d/single-cluster/values-dp.yaml`}
</CodeBlock>

Wait for the installation to complete, then verify that all pods are running:

```bash
kubectl get pods -n openchoreo-data-plane
```

You should see running pods for:
- `envoy-gateway-*` 
- `external-secrets-*` (3 pods)
- `fluent-bit-*` (Running on each node)
- `gateway-external-*` 
</div>

<div className="step-card">
<div className="step-header">
<div className="step-header-icon">4</div>
<div className="step-header-text">Install the OpenChoreo Build Plane (Optional)</div>
</div>

Install this plane if you plan to use OpenChoreo’s internal CI capabilities. The `openchoreo-build-plane` namespace is created automatically. If you're only deploying pre-built container images, you can skip this step.

<CodeBlock language="bash">
{`helm install openchoreo-build-plane oci://ghcr.io/openchoreo/helm-charts/openchoreo-build-plane \\
  --version ${versions.helmChart} \\
  --kube-context k3d-openchoreo \\
  --namespace openchoreo-build-plane \\
  --create-namespace \\
  --values https://raw.githubusercontent.com/openchoreo/openchoreo/${versions.githubRef}/install/k3d/single-cluster/values-bp.yaml`}
</CodeBlock>

Wait for the installation to complete, then verify that all pods are running:

```bash
kubectl get pods -n openchoreo-build-plane
```

You should see running pods for:
- `argo-server-*` 
- `argo-workflow-controller-*` 
- `registry-*` 

#### Configure the Build Plane

Register the build plane with the control plane by running the script below. It creates a build plane resource in the default namespace.

<CodeBlock language="bash">
{`curl -s https://raw.githubusercontent.com/openchoreo/openchoreo/${versions.githubRef}/install/add-build-plane.sh | bash -s -- --control-plane-context k3d-openchoreo`}
</CodeBlock>

Verify that the Build Plane was created:

```bash
kubectl get buildplane -n default
```
</div>

<div className="step-card">
<div className="step-header">
<div className="step-header-icon">5</div>
<div className="step-header-text">Configure the DataPlane</div>
</div>

Register the data plane with the control plane by running the script below. It creates a data plane resource in the default namespace.

<CodeBlock language="bash">
{`curl -s https://raw.githubusercontent.com/openchoreo/openchoreo/${versions.githubRef}/install/add-data-plane.sh | bash -s -- --control-plane-context k3d-openchoreo`}
</CodeBlock>

Verify that the DataPlane was created:

```bash
kubectl get dataplane -n default
```
</div>

<div className="step-card">
<div className="step-header">
<div className="step-header-icon">6</div>
<div className="step-header-text">Install the OpenChoreo Observability Plane (Optional)</div>
</div>

Install the observability plane components. The `openchoreo-observability-plane` namespace is created automatically:

<CodeBlock language="bash">
{`helm install openchoreo-observability-plane oci://ghcr.io/openchoreo/helm-charts/openchoreo-observability-plane \\
  --version ${versions.helmChart} \\
  --kube-context k3d-openchoreo \\
  --namespace openchoreo-observability-plane \\
  --create-namespace \\
  --values https://raw.githubusercontent.com/openchoreo/openchoreo/${versions.githubRef}/install/k3d/single-cluster/values-op.yaml`}
</CodeBlock>

Wait for the installation to complete, then verify that all pods are running:

```bash
kubectl get pods -n openchoreo-observability-plane
```

You should see running pods for:
- `observer-*` - Log processing service
- `opensearch-master-0` - Log storage backend
- `opensearch-dashboards-*` - Visualization dashboard
- `opensearch-cluster-setup-*` (Completed) - One-time setup job

:::note
The OpenSearch dashboard pod may take several minutes to start.
:::

Verify that all pods are ready:

```bash
kubectl wait --for=condition=Ready pod --all -n openchoreo-observability-plane --timeout=600s
```

Verify that FluentBit is sending logs to OpenSearch:

```bash
# Check if Kubernetes indices are being created
kubectl exec -n openchoreo-observability-plane opensearch-master-0 -- curl -s "http://localhost:9200/_cat/indices?v" | grep kubernetes

# Check the recent log count
kubectl exec -n openchoreo-observability-plane opensearch-master-0 -- curl -s "http://localhost:9200/kubernetes-*/_count" | jq '.count'
```

If the indices exist and the count is greater than 0, FluentBit is successfully collecting and storing logs.
</div>

<div className="step-card">
<div className="step-header">
<div className="step-header-icon">7</div>
<div className="step-header-text">Verify the OpenChoreo Installation</div>
</div>

Verify that default OpenChoreo resources were created:

```bash
# Check default organizations, projects, and environments
kubectl get organizations,projects,environments -A

# Check default component types
kubectl get componenttypes -n default

# Check all OpenChoreo CRDs
kubectl get crds | grep openchoreo

# Check gateway resources
kubectl get gateway,httproute -n openchoreo-data-plane
```

Confirm all workloads are running:

```bash
# Check cluster info
kubectl cluster-info --context k3d-openchoreo

# Check control plane pods
kubectl get pods -n openchoreo-control-plane

# Check data plane pods
kubectl get pods -n openchoreo-data-plane

# Check build plane pods (if installed)
kubectl get pods -n openchoreo-build-plane

# Check observability plane pods (if installed)
kubectl get pods -n openchoreo-observability-plane

# Check nodes (should be Ready)
kubectl get nodes
```
</div>

## Next Steps

After completing this setup, you can:

1. [Deploy your first component](./deploy-first-component.mdx) to get started with OpenChoreo.
2. Explore the <Link to={`https://github.com/openchoreo/openchoreo/tree/${versions.githubRef}/samples/gcp-microservices-demo`}>GCP microservices demo</Link> to see multi-component applications in action.
3. Deploy additional sample applications from <Link to={`https://github.com/openchoreo/openchoreo/tree/${versions.githubRef}/samples`}>OpenChoreo samples</Link>.
4. Develop and test new OpenChoreo features.

<div className="content-section-highlight">
## Image Preloading (Optional)

If you have a slow network or want to save bandwidth when recreating clusters, preload images before installing components. This pulls the images to your host machine and then imports them into the k3d cluster.

Run this after creating the cluster (Step 1) and before installing components (Step 2). Refer to the <Link to={`https://github.com/openchoreo/openchoreo/tree/${versions.githubRef}/install/k3d/single-cluster#image-preloading-optional`}>k3d single-cluster README</Link> for detailed preloading instructions.
</div>
<div className="content-section-highlight">
## Cleaning Up

To completely remove the development environment:

```bash
# Delete the k3d cluster
k3d cluster delete openchoreo
```
</div>