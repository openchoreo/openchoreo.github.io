---
title: Container Registry Configuration
description: Configure the Build Plane to push images to your container registry.
sidebar_position: 3
---

import CodeBlock from '@theme/CodeBlock';
import {versions} from '../_constants.mdx';

# Container Registry Configuration

The Build Plane requires a container registry to store built images. Both build pods (for pushing) and kubelets on the Data Plane (for pulling) need access to the registry.

## Configuration Parameters

| Parameter | Description | Required |
|-----------|-------------|----------|
| `global.defaultResources.registry.host` | Registry hostname | Yes |
| `global.defaultResources.registry.repoPath` | Path prefix for images | No |
| `global.defaultResources.registry.tlsVerify` | Verify TLS certificates | No (default: `false`) |

## Registry Providers

### Amazon ECR

See [Amazon ECR documentation](https://docs.aws.amazon.com/AmazonECR/latest/userguide/getting-started-cli.html) for repository setup and IAM configuration.

<CodeBlock language="bash">
{`helm upgrade --install openchoreo-build-plane oci://ghcr.io/openchoreo/helm-charts/openchoreo-build-plane \\
  --version ${versions.helmChart} \\
  --namespace openchoreo-build-plane \\
  --set global.defaultResources.registry.host=123456789.dkr.ecr.us-east-1.amazonaws.com \\
  --set global.defaultResources.registry.repoPath=openchoreo-builds \\
  --set global.defaultResources.registry.tlsVerify=true`}
</CodeBlock>

### Google Artifact Registry

See [Artifact Registry documentation](https://cloud.google.com/artifact-registry/docs/docker/store-docker-container-images) for repository setup and authentication.

<CodeBlock language="bash">
{`helm upgrade --install openchoreo-build-plane oci://ghcr.io/openchoreo/helm-charts/openchoreo-build-plane \\
  --version ${versions.helmChart} \\
  --namespace openchoreo-build-plane \\
  --set global.defaultResources.registry.host=us-central1-docker.pkg.dev/my-project/openchoreo-builds \\
  --set global.defaultResources.registry.tlsVerify=true`}
</CodeBlock>

### Azure Container Registry

See [ACR documentation](https://learn.microsoft.com/en-us/azure/container-registry/container-registry-get-started-azure-cli) for registry setup and AKS integration.

<CodeBlock language="bash">
{`helm upgrade --install openchoreo-build-plane oci://ghcr.io/openchoreo/helm-charts/openchoreo-build-plane \\
  --version ${versions.helmChart} \\
  --namespace openchoreo-build-plane \\
  --set global.defaultResources.registry.host=myregistry.azurecr.io \\
  --set global.defaultResources.registry.tlsVerify=true`}
</CodeBlock>

### GitHub Container Registry

See [GHCR documentation](https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-container-registry) for authentication setup.

<CodeBlock language="bash">
{`helm upgrade --install openchoreo-build-plane oci://ghcr.io/openchoreo/helm-charts/openchoreo-build-plane \\
  --version ${versions.helmChart} \\
  --namespace openchoreo-build-plane \\
  --set global.defaultResources.registry.host=ghcr.io \\
  --set global.defaultResources.registry.repoPath=my-org/openchoreo \\
  --set global.defaultResources.registry.tlsVerify=true`}
</CodeBlock>

### Docker Hub

See [Docker Hub documentation](https://docs.docker.com/docker-hub/repos/create/) for repository setup. Note the [rate limits](https://docs.docker.com/docker-hub/download-rate-limit/) for free accounts.

<CodeBlock language="bash">
{`helm upgrade --install openchoreo-build-plane oci://ghcr.io/openchoreo/helm-charts/openchoreo-build-plane \\
  --version ${versions.helmChart} \\
  --namespace openchoreo-build-plane \\
  --set global.defaultResources.registry.host=docker.io \\
  --set global.defaultResources.registry.repoPath=your-username \\
  --set global.defaultResources.registry.tlsVerify=true`}
</CodeBlock>

## Authentication

### Push Secret (Build Plane)

For registries requiring authentication, configure push credentials for the build plane.

### Step 1: Encode Your Credentials

Generate base64-encoded credentials:

```bash
echo -n 'your-username:your-password' | base64
```

**Example output:** `ZGVtby11c2VyOmRlbW8tcGFzcw==`

### Step 2: Create Docker Config JSON

Use the following format with escaped quotes (required for kubectl). Replace placeholders:
- `<REGISTRY-HOST>`: Your registry host
- `<BASE64-TOKEN>`: Your base64 string from Step 1

**Template:**
```
{\"auths\":{\"<REGISTRY-HOST>\":{\"auth\":\"<BASE64-TOKEN>\"}}}
```

### Step 3: Apply to ClusterSecretStore

:::info
**Development/Testing:** Use the fake provider (shown below)
**Production:** Add to your secret backend (AWS Secrets Manager, Vault, etc.) with key `registry-push-secret`
:::

Apply the patch command with your formatted JSON from Step 2:

```bash
kubectl patch clustersecretstore default --type='json' -p='[
  {
    "op": "add",
    "path": "/spec/provider/fake/data/-",
    "value": {
      "key": "registry-push-secret",
      "value": "{\"auths\":{\"<REGISTRY-HOST>\":{\"auth\":\"<BASE64-TOKEN>\"}}}"
    }
  }
]'
```

**Complete example for Docker Hub:**

```bash
kubectl patch clustersecretstore default --type='json' -p='[
  {
    "op": "add",
    "path": "/spec/provider/fake/data/-",
    "value": {
      "key": "registry-push-secret",
      "value": "{\"auths\":{\"https://index.docker.io/v1/\":{\"auth\":\"ZGVtby11c2VyOmRlbW8tcGFzcw==\"}}}"
    }
  }
]'
```

### Pull Secret (Data Plane)

For pulling images from private registries, see [Deploy from a Private Registry](../use-cases/deploy-prebuilt-image.mdx#deploy-from-a-private-registry).

## Troubleshooting

| Symptom | Check |
|---------|-------|
| "unauthorized" error | Verify `registry-push-secret` exists and credentials are valid |
| `ImagePullBackOff` | Verify image exists and ImagePullSecret is configured |
| "x509: certificate signed by unknown authority" | Set `tlsVerify=false` or configure CA certificate |
| "connection refused" | Check network connectivity and firewall rules |
